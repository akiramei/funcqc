# CLAUDE.md

@~/.claude/CLAUDE.md  # ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã‚’æ˜ç¤ºçš„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

## Database Schema - Single Source of Truth

**âš ï¸ CRITICAL: Database Schema Management**

### ğŸ“„ **Authoritative Schema Source**
- **Single Source of Truth**: `src/schemas/database.sql`
- **Complete Definition**: All 12 tables, indexes, constraints, and documentation
- **Automatic Loading**: Implementation reads this file dynamically

### ğŸš« **Absolute Prohibitions**
- âŒ **NEVER edit schema in TypeScript files** (`pglite-adapter.ts`)
- âŒ **NEVER create separate DDL files** for individual tables

### ğŸ“‹ **Table Information**
To understand any table structure, column definitions, indexes, or relationships:
```bash
# View complete schema with documentation
cat src/schemas/database.sql

# Or use your IDE to open:
src/schemas/database.sql
```

### ğŸ›¡ï¸ **Consistency Guarantee**
- **Physical Prevention**: Implementation cannot diverge from schema file
- **Human Error Elimination**: No manual synchronization required
- **Zero Risk**: Schema inconsistencies are physically impossible

## ã‚³ãƒ¼ãƒ‰å“è³ªç®¡ç†

### ğŸ¯ æœ€é‡è¦åŸå‰‡ï¼šHealth Scoreæœ€å„ªå…ˆ

**funcqcã«ãŠã‘ã‚‹å“è³ªç®¡ç†ã®çµ¶å¯¾åŸå‰‡**ï¼š**Health Scoreå‘ä¸ŠãŒå”¯ä¸€ã®ç›®æ¨™**

#### ğŸš¨ CRITICAL: Health Commandåˆ†æçµæœã®é‡è¦–

**å¿…é ˆå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ï¼ˆä¾‹å¤–ãªã—ï¼‰**ï¼š
```bash
# ã™ã¹ã¦ã®å“è³ªæ”¹å–„ä½œæ¥­ã®èµ·ç‚¹ï¼ˆæ–°ã—ã„é«˜åº¦åˆ†ææ©Ÿèƒ½ä»˜ãï¼‰
npm run dev -- assess --advanced

# å¾“æ¥æ–¹å¼ï¼ˆåŸºæœ¬çš„ãªå“è³ªãƒ¬ãƒãƒ¼ãƒˆï¼‰
npm run dev -- assess --type health --verbose
```

#### ğŸ“Š Health Reportåˆ†æã§é‡è¦–ã™ã¹ãæŒ‡æ¨™

**æœ€å„ªå…ˆæŒ‡æ¨™ï¼ˆæ§‹é€ çš„å•é¡Œï¼‰**ï¼š
1. **Overall Health Index**: æ•°å€¤ãŒä½ã„ã»ã©æ§‹é€ çš„å•é¡ŒãŒæ·±åˆ»
2. **Structural Risk**: CRITICALã®å ´åˆã¯ç·Šæ€¥å¯¾å¿œå¿…è¦
3. **Structural Penalty Breakdown**: æœ€å¤§ã®ãƒšãƒŠãƒ«ãƒ†ã‚£è¦å› ã‚’ç‰¹å®š
   - **High Coupling (Fan-in)**: æœ€ã‚‚é‡è¦ãªæ§‹é€ çš„å•é¡Œ
   - **Cyclic Functions**: å¾ªç’°ä¾å­˜ã®æ•°
   - **Hub Functions**: éåº¦ãªçµåˆã‚’æŒã¤é–¢æ•°
4. **PageRank Centrality Analysis**: ä¸­å¿ƒæ€§ã®ä¸å¹³ç­‰åº¦
   - **Gini Coefficient**: 98%+ã¯å±é™ºãªé›†ä¸­çŠ¶æ…‹
   - **Most Central Functions**: ãƒœãƒˆãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®ç‰¹å®š

**æ³¨ç›®ã™ã¹ãå…·ä½“çš„æ•°å€¤**ï¼š
- **Max Fan-in**: 100+ã¯ç•°å¸¸å€¤ã€è¦æ”¹å–„
- **Hub Functions**: 30å€‹æœªæº€ãŒç›®æ¨™
- **Cyclic Functions**: 10å€‹æœªæº€ãŒç›®æ¨™
- **Centrality Gini Coefficient**: 90%æœªæº€ãŒç›®æ¨™

#### ğŸš¨ CRITICAL: Health Reportè§£é‡ˆã®çµ¶å¯¾ãƒ«ãƒ¼ãƒ«

**Health Reportã®æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç„¡è¦–ãƒ«ãƒ¼ãƒ«**ï¼š
- å ±å‘Šæ›¸ã§ã€ŒHigh-Risk Functions (CC: XX)ã€ã¨è¡¨ç¤ºã•ã‚Œã¦ã‚‚ **CCå€¤ã¯ä¸€åˆ‡è€ƒæ…®ã—ãªã„**
- ã€ŒanalyzeFile() (Risk: 13, CC: 21)ã€ã®ã‚ˆã†ãªè¡¨è¨˜ã« **æƒ‘ã‚ã•ã‚Œãªã„**
- **æ§‹é€ çš„åˆ†æã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿**ã«æ³¨ç›®ã™ã‚‹

**çµ¶å¯¾ç¦æ­¢ã®æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**ï¼š
- âŒ ã€ŒCCå€¤ãŒé«˜ã„ã‹ã‚‰å•é¡Œã€
- âŒ ã€Œæ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«CCå€¤ãŒã‚ã‚‹ã‹ã‚‰CCé‡è¦–ã€
- âŒ ã€ŒHigh-Risk = é«˜CCã€ã¨ã„ã†èª¤è§£
- âŒ Health Reportã®CCå€¤ã¸ã®ä¸€åˆ‡ã®æ³¨ç›®

**æ­£ã—ã„æ”¹å–„å¯¾è±¡ã®ç‰¹å®šæ–¹æ³•**ï¼š
1. **Structural Penalty Breakdown**ã§æœ€å¤§ãƒšãƒŠãƒ«ãƒ†ã‚£è¦å› ã‚’ç‰¹å®š
2. **Most Central Functions**ã§ãƒœãƒˆãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’ç‰¹å®š
3. **Max Fan-in**ç•°å¸¸å€¤ã®é–¢æ•°ã‚’ç‰¹å®š
4. **Hub Functions**ãƒªã‚¹ãƒˆã‹ã‚‰éåº¦çµåˆé–¢æ•°ã‚’ç‰¹å®š

**ğŸš¨ CRITICAL WARNING**ï¼šCCå€¤ã«ã‚ˆã‚‹æ©Ÿæ¢°çš„ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã¯**ç¦æ­¢**
- CCå‰Šæ¸› â‰  å“è³ªå‘ä¸Š
- CCã¯åˆ¤æ–­ææ–™ã§ã‚ã‚Šã€åˆ†å‰²æ±ºå®šã§ã¯ãªã„
- Health ScoreãŒæ”¹å–„ã—ãªã„ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã¯ç„¡ä¾¡å€¤

### ğŸ“ˆ ã‚¹ã‚³ã‚¢æ”¹å–„ç›®æ¨™ã¨æˆåŠŸåŸºæº–

**ğŸ¯ æ”¹å–„ç›®æ¨™ã®è¨­å®šæ–¹æ³•**:
1. **ç¾åœ¨ã®Health Index**ã‚’åŸºæº–ã¨ã—ãŸå…·ä½“çš„ãªç›®æ¨™è¨­å®š
2. **æ§‹é€ çš„ãƒšãƒŠãƒ«ãƒ†ã‚£**ã®æ®µéšçš„å‰Šæ¸›
3. **æ•°å€¤çš„ãªæˆåŠŸåŸºæº–**ã®æ˜ç¢ºåŒ–

**ğŸ“Š å…·ä½“çš„ãªæ”¹å–„ç›®æ¨™ä¾‹**:
```
ç¾åœ¨: Overall Health Index 18.2/100 (Critical)
ç›®æ¨™: Overall Health Index 40.0/100 (Fair) ä»¥ä¸Š

ç¾åœ¨: Max Fan-in 265 (ç•°å¸¸å€¤)
ç›®æ¨™: Max Fan-in 100æœªæº€

ç¾åœ¨: Hub Functions 41å€‹
ç›®æ¨™: Hub Functions 30å€‹æœªæº€

ç¾åœ¨: Cyclic Functions 18å€‹  
ç›®æ¨™: Cyclic Functions 10å€‹æœªæº€

ç¾åœ¨: Centrality Gini Coefficient 98.0% (æ¥µåº¦ä¸å¹³ç­‰)
ç›®æ¨™: Centrality Gini Coefficient 90%æœªæº€
```

**âœ… æ”¹å–„å®Œäº†ã®åˆ¤å®šåŸºæº–**:
- Health Index ãŒ20ptä»¥ä¸Šå‘ä¸Š
- Structural Risk ãŒ CRITICAL â†’ WARNING ä»¥ä¸Šã«æ”¹å–„
- æœ€å¤§ãƒšãƒŠãƒ«ãƒ†ã‚£è¦å› ãŒ50%ä»¥ä¸Šå‰Šæ¸›

### å“è³ªç®¡ç†ã®åŸºæœ¬ãƒ•ãƒ­ãƒ¼

**å¿…é ˆæ‰‹é †ï¼ˆä¾‹å¤–ãªã—ï¼‰**:
1. **æ”¹å–„å‰**: `npm run dev -- assess --advanced` ã§ç¾çŠ¶æŠŠæ¡
2. **ç›®æ¨™è¨­å®š**: ä¸Šè¨˜åŸºæº–ã«åŸºã¥ãå…·ä½“çš„æ•°å€¤ç›®æ¨™
3. **æ”¹å–„å®Ÿæ–½**: æ§‹é€ çš„å•é¡Œã«é›†ä¸­ã—ãŸæ”¹å–„
4. **æ”¹å–„å¾Œ**: å†åº¦assessåˆ†æã§ç›®æ¨™é”æˆã‚’ç¢ºèª
5. **PRä½œæˆå‰**: ãƒ•ã‚¡ã‚¤ãƒ«è¡Œæ•°ãƒã‚§ãƒƒã‚¯ï¼ˆä¸‹è¨˜å‚ç…§ï¼‰
6. **ã‚³ãƒŸãƒƒãƒˆ**: ç›®æ¨™é”æˆæ™‚ã®ã¿ã‚³ãƒŸãƒƒãƒˆå®Ÿè¡Œ

### ğŸ“ PRä½œæˆå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«è¡Œæ•°ãƒã‚§ãƒƒã‚¯ï¼ˆå¿…é ˆï¼‰

**ğŸš¨ CRITICAL: ç·¨é›†ãƒ•ã‚¡ã‚¤ãƒ«ã®å·¨å¤§åŒ–é˜²æ­¢**

**å¿…é ˆãƒã‚§ãƒƒã‚¯ã‚³ãƒãƒ³ãƒ‰**:
```bash
# ãƒˆãƒƒãƒ—10æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
npm run dev -- inspect --type files --sort lines --desc --limit 10
```

**åˆ†å‰²å¿…è¦æ€§ã®åˆ¤å®šåŸºæº–**:
- **ç·¨é›†ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒˆãƒƒãƒ—10ã«å…¥ã£ã¦ã„ã‚‹å ´åˆ**: å¿…ãšåˆ†å‰²å®Ÿæ–½
- **1,000è¡Œè¶…ãˆã®ãƒ•ã‚¡ã‚¤ãƒ«**: åˆ†å‰²ã‚’å¼·ãæ¨å¥¨
- **500è¡Œè¶…ãˆã®ãƒ•ã‚¡ã‚¤ãƒ«**: åˆ†å‰²ã‚’æ¤œè¨

**ãƒˆãƒƒãƒ—10åœå¤–ã«ã™ã‚‹æ‰‹æ³•**:
1. **æ©Ÿèƒ½åˆ¥åˆ†å‰²**: é–¢é€£ã™ã‚‹é–¢æ•°ç¾¤ã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«æŠ½å‡º
2. **ãƒ¬ã‚¤ãƒ¤ãƒ¼å†…shared/**: å…±é€šæ©Ÿèƒ½ã‚’ `layer/shared/` ã«åˆ†é›¢
3. **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£æŠ½å‡º**: æ±ç”¨é–¢æ•°ã‚’ `utils/` ã«ç§»å‹•
4. **å‹å®šç¾©åˆ†é›¢**: å¤§ããªå‹å®šç¾©ã‚’åˆ¥ã® `.types.ts` ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†é›¢

**åˆ†å‰²å®Œäº†ã®ç¢ºèª**:
```bash
# åˆ†å‰²å¾Œã«å†ç¢ºèªï¼ˆç·¨é›†ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒˆãƒƒãƒ—10åœå¤–ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
npm run dev -- inspect --type files --sort lines --desc --limit 10
```

**ğŸ¯ åˆ†å‰²ç›®æ¨™**:
- ç·¨é›†ãƒ•ã‚¡ã‚¤ãƒ«: ãƒˆãƒƒãƒ—10åœå¤–
- ç†æƒ³çš„è¡Œæ•°: 500è¡Œæœªæº€
- æœ€å¤§è¨±å®¹: 800è¡Œæœªæº€

### å“è³ªæ”¹å–„ã®åŸºæœ¬æ‰‹æ³•
- **Fan-inå‰Šæ¸›**: éåº¦ãªçµåˆã‚’æŒã¤é–¢æ•°ã®è²¬å‹™åˆ†æ•£
- **Hubé–¢æ•°åˆ†å‰²**: ä¸­å¿ƒçš„ãƒœãƒˆãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®åˆ†è§£
- **å¾ªç’°ä¾å­˜è§£æ¶ˆ**: Cyclic Functions ã®æ§‹é€ æ”¹å–„
- **ä¸­å¿ƒæ€§åˆ†æ•£**: PageRankä¸å¹³ç­‰ã®æ”¹å–„

## PRãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œãƒ•ãƒ­ãƒ¼

### ğŸ› ï¸ pr-getãƒ„ãƒ¼ãƒ«ã«ã‚ˆã‚‹ä½“ç³»çš„ãƒ¬ãƒ“ãƒ¥ãƒ¼ç®¡ç†

**pr-get**ãƒ„ãƒ¼ãƒ«ï¼ˆ`scripts/pr-get.ts`ï¼‰ã¯ã€GitHub PRã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä½“ç³»çš„ã«ç®¡ç†ã—ã€å¯¾å¿œæ¼ã‚Œã‚’é˜²ããŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

### ğŸ“‹ åŸºæœ¬çš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```bash
# Step 1: PRãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—
npx tsx scripts/pr-get.ts <PRç•ªå·> --repo <owner/repo>

# Step 2: ã‚³ãƒ¡ãƒ³ãƒˆãŒpr/XX/comments/ã«å€‹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã•ã‚Œã‚‹
# ä¾‹: pr/237/comments/comment-001-src-storage-pglite-adapter-ts.md

# Step 3: å„ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦å¯¾å¿œ
# å¯¾å¿œå®Œäº†: pr/XX/comments/accepts/ã¸ç§»å‹•
# ä¸æ¡ç”¨: pr/XX/comments/rejects/ã¸ç§»å‹•ï¼ˆç†ç”±ã‚’æ˜è¨˜ï¼‰

# Step 4: ã‚³ãƒŸãƒƒãƒˆå‰ã«æœªå¯¾å¿œç¢ºèª
ls pr/XX/comments/*.md  # æ®‹ã£ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ« = æœªå¯¾å¿œ
```

### ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
pr/
â””â”€â”€ <PRç•ªå·>/
    â””â”€â”€ comments/
        â”œâ”€â”€ comment-XXX-*.md      # æœªå¯¾å¿œã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆ
        â”œâ”€â”€ accepts/              # å¯¾å¿œå®Œäº†ã—ãŸã‚³ãƒ¡ãƒ³ãƒˆ
        â”‚   â””â”€â”€ comment-XXX-*.md
        â””â”€â”€ rejects/              # ä¸æ¡ç”¨ã¨ã—ãŸã‚³ãƒ¡ãƒ³ãƒˆ
            â”œâ”€â”€ comment-XXX-*.md
            â””â”€â”€ README.md         # ä¸æ¡ç”¨ç†ç”±ã®èª¬æ˜æ›¸
```

### ğŸ” pr-getãƒ„ãƒ¼ãƒ«ã®ä½¿ç”¨æ–¹æ³•

```bash
# åŸºæœ¬ä½¿ç”¨
npx tsx scripts/pr-get.ts 237 --repo akiramei/funcqc

# å‡ºåŠ›å…ˆå¤‰æ›´
npx tsx scripts/pr-get.ts 237 --repo akiramei/funcqc --out custom/path/

# ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã›ãšç¢ºèªï¼‰
npx tsx scripts/pr-get.ts 237 --repo akiramei/funcqc --dry-run
```

### ğŸ“„ ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼

å„ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã¯ä»¥ä¸‹ã®å½¢å¼ã§ä¿å­˜ã•ã‚Œã¾ã™ï¼š

```markdown
---
commentId: 2234233287
reviewer: coderabbitai[bot]
createdAt: 2025-07-28T01:07:48Z
filePath: src/storage/pglite-adapter.ts
line: 744
---

[ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡]

## å¯¾å¿œãƒ­ã‚°
- [ ] ç†è§£å®Œäº†
- [ ] å¯¾å¿œæ–¹é‡æ±ºå®š
- [ ] ä¿®æ­£å®Ÿæ–½æ¸ˆã¿
- [ ] ãƒ†ã‚¹ãƒˆç¢ºèª
```

### âœ… å¯¾å¿œçŠ¶æ³ã®ç®¡ç†

#### **å¯¾å¿œå®Œäº†ï¼ˆacceptsï¼‰**
```bash
# å¯¾å¿œã—ãŸã‚³ãƒ¡ãƒ³ãƒˆã‚’acceptsãƒ•ã‚©ãƒ«ãƒ€ã¸ç§»å‹•
mv pr/237/comments/comment-001-*.md pr/237/comments/accepts/
```

#### **ä¸æ¡ç”¨ï¼ˆrejectsï¼‰**
```bash
# ä¸æ¡ç”¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’rejectsãƒ•ã‚©ãƒ«ãƒ€ã¸ç§»å‹•
mv pr/237/comments/comment-002-*.md pr/237/comments/rejects/

# ç†ç”±ã‚’æ˜è¨˜ï¼ˆrejects/README.mdï¼‰
echo "PRç¯„å›²å¤–ã®ãŸã‚æ¬¡å›å¯¾å¿œ" >> pr/237/comments/rejects/README.md
```

### ğŸ“Š é€²æ—ç¢ºèª

```bash
# å¯¾å¿œçŠ¶æ³ã®ç¢ºèª
echo "æœªå¯¾å¿œ: $(ls pr/237/comments/*.md 2>/dev/null | wc -l)ä»¶"
echo "å¯¾å¿œæ¸ˆã¿: $(ls pr/237/comments/accepts/*.md 2>/dev/null | wc -l)ä»¶"
echo "ä¸æ¡ç”¨: $(ls pr/237/comments/rejects/*.md 2>/dev/null | wc -l)ä»¶"
```

### ğŸš¨ ã‚³ãƒŸãƒƒãƒˆå‰ãƒã‚§ãƒƒã‚¯

```bash
# æœªå¯¾å¿œã‚³ãƒ¡ãƒ³ãƒˆã®ç¢ºèª
if [ $(ls pr/237/comments/*.md 2>/dev/null | wc -l) -gt 0 ]; then
  echo "âš ï¸ æœªå¯¾å¿œã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆãŒæ®‹ã£ã¦ã„ã¾ã™"
  ls pr/237/comments/*.md
  exit 1
fi

# ä¸æ¡ç”¨ç†ç”±ã®ç¢ºèª
if [ -d pr/237/comments/rejects ] && [ ! -f pr/237/comments/rejects/README.md ]; then
  echo "âš ï¸ ä¸æ¡ç”¨ç†ç”±ã®èª¬æ˜ãŒå¿…è¦ã§ã™"
  exit 1
fi
```

### ğŸ’¡ ãƒ¡ãƒªãƒƒãƒˆ

1. **è¦‹è½ã¨ã—é˜²æ­¢**: ç‰©ç†ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ã«ã‚ˆã‚Šå¯¾å¿œæ¼ã‚ŒãŒä¸å¯èƒ½
2. **é€²æ—å¯è¦–åŒ–**: ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ã§å¯¾å¿œçŠ¶æ³ãŒä¸€ç›®ç­ç„¶
3. **èª¬æ˜è²¬ä»»**: ä¸æ¡ç”¨ç†ç”±ã®æ˜æ–‡åŒ–ã‚’å¼·åˆ¶
4. **ç›£æŸ»è¨¼è·¡**: ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œã®å±¥æ­´ãŒæ®‹ã‚‹

### âš ï¸ æ³¨æ„äº‹é …

- `pr/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯`.gitignore`ã«è¿½åŠ æ¸ˆã¿ï¼ˆã‚³ãƒŸãƒƒãƒˆå¯¾è±¡å¤–ï¼‰

## funcqcä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰ï¼ˆé–‹ç™ºæ™‚ã®å“è³ªç®¡ç†ãƒ„ãƒ¼ãƒ«ï¼‰

### ğŸ” åŸºæœ¬çš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆæ–°ã‚³ãƒãƒ³ãƒ‰ä½“ç³»ï¼‰

```bash
# 1. ä½œæ¥­é–‹å§‹æ™‚ã«ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½œæˆï¼ˆãƒ–ãƒ©ãƒ³ãƒåã§ãƒ©ãƒ™ãƒ«ä»˜ã‘ï¼‰
npm run dev -- measure --label feature/my-branch

# 2. é–¢æ•°ã®å“è³ªçŠ¶æ³ã‚’ç¢ºèª
npm run dev -- assess --advanced                   # å…¨ä½“çš„ãªå“è³ªãƒ¬ãƒãƒ¼ãƒˆï¼ˆé«˜åº¦åˆ†æï¼‰
npm run dev -- inspect --cc-ge 10                 # è¤‡é›‘åº¦10ä»¥ä¸Šã®é–¢æ•°ä¸€è¦§

# 3. ä½œæ¥­å¾Œã«å†åº¦ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦æ¯”è¼ƒ
npm run dev -- measure --label feature/my-branch-after
npm run dev -- manage --action=diff --from HEAD~1 --to HEAD  # å¤‰æ›´å†…å®¹ã®ç¢ºèª
```

### ğŸ“Š ä¸»è¦ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

#### measure - é–¢æ•°æ¸¬å®šã¨åˆ†æï¼ˆscanã®é€²åŒ–ç‰ˆï¼‰
```bash
# åŸºæœ¬æ¸¬å®šï¼ˆscanã®å¾Œç¶™ï¼‰
npm run dev -- measure

# ãƒ©ãƒ™ãƒ«ä»˜ãæ¸¬å®šï¼ˆæ¨å¥¨ï¼‰
npm run dev -- measure --label <label-name>

# é«˜åº¦ãªåˆ†æä»˜ãæ¸¬å®š
npm run dev -- measure --level complete --call-graph --types --coupling

# åºƒç¯„å›²åˆ†æï¼ˆæ—§scanã®å®Œå…¨ä»£æ›¿ï¼‰
npm run dev -- measure --full --with-graph --with-types --with-coupling
```

#### inspect - çµ±åˆæ¤œæŸ»ã‚³ãƒãƒ³ãƒ‰ï¼ˆlistã€filesã€showã€searchã®çµ±åˆï¼‰
```bash
# å…¨é–¢æ•°è¡¨ç¤ºï¼ˆæ—§listã®ä»£æ›¿ï¼‰
npm run dev -- inspect

# è¤‡é›‘åº¦ã§ãƒ•ã‚£ãƒ«ã‚¿
npm run dev -- inspect --cc-ge 10                    # è¤‡é›‘åº¦10ä»¥ä¸Š
npm run dev -- inspect --cc-ge 20 --limit 10 --sort cc --desc

# ãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ•ã‚£ãƒ«ã‚¿
npm run dev -- inspect --file src/storage/pglite-adapter.ts

# é–¢æ•°åã§ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆæ—§searchã®ä»£æ›¿ï¼‰
npm run dev -- inspect --name analyze

# è©³ç´°æƒ…å ±è¡¨ç¤ºï¼ˆæ—§showã®ä»£æ›¿ï¼‰
npm run dev -- inspect --detailed --name <function-name>

# ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ï¼ˆæ—§filesã®ä»£æ›¿ï¼‰
npm run dev -- inspect --type files --sort lines --desc --limit 10
```

#### assess - çµ±åˆå“è³ªè©•ä¾¡ã‚³ãƒãƒ³ãƒ‰ï¼ˆé«˜åº¦ãªAIåˆ†ææ©Ÿèƒ½ä»˜ãï¼‰
```bash
# åŸºæœ¬å“è³ªãƒ¬ãƒãƒ¼ãƒˆï¼ˆæ—§healthã®ä»£æ›¿ï¼‰
npm run dev -- assess --type health

# è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆï¼ˆå¾“æ¥ã®health --verboseã®ä»£æ›¿ï¼‰
npm run dev -- assess --type health --verbose

# é«˜åº¦åˆ†æï¼ˆæ¨å¥¨ï¼‰
npm run dev -- assess --advanced

# å‹•çš„é‡ã¿ä»˜ã‘è©•ä¾¡
npm run dev -- assess --advanced --mode dynamic

# ã‚³ãƒ¼ãƒ‰å“è³ªè©•ä¾¡ï¼ˆæ—§evaluateã®ä»£æ›¿ï¼‰
npm run dev -- assess --type quality

# å‹ã‚·ã‚¹ãƒ†ãƒ å“è³ªè©•ä¾¡
npm run dev -- assess --type types
```

#### å±¥æ­´ç®¡ç†
```bash
# ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå±¥æ­´ã‚’è¡¨ç¤ºï¼ˆæ—§historyã®ä»£æ›¿ï¼‰
npm run dev -- manage --action=history

# æ¸¬å®šå±¥æ­´ã‚’è¡¨ç¤º
npm run dev -- measure --history
```

#### diff - å¤‰æ›´å·®åˆ†
```bash
# ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆé–“ã®å·®åˆ†
npm run dev -- manage --action=diff --from <from> --to <to>

# æŒ‡å®šå¯èƒ½ãªå€¤ï¼š
# - ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆID: fd526278
# - ãƒ©ãƒ™ãƒ«: main
# - HEADè¨˜æ³•: HEAD, HEAD~1, HEAD~3

# é¡ä¼¼é–¢æ•°ã®æ´å¯Ÿä»˜ã
npm run dev -- manage --action=diff --from <from> --to <to> --insights

# ã‚«ã‚¹ã‚¿ãƒ é¡ä¼¼åº¦é–¾å€¤ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0.95ï¼‰
npm run dev -- manage --action=diff --from <from> --to <to> --similarity-threshold 0.8
```

#### ãƒ•ã‚¡ã‚¤ãƒ«åˆ†æï¼ˆinspectã«çµ±åˆï¼‰
```bash
# è¡Œæ•°ã®å¤šã„ãƒ•ã‚¡ã‚¤ãƒ«TOP10ï¼ˆæ—§filesã®ä»£æ›¿ï¼‰
npm run dev -- inspect --type files --sort lines --desc --limit 10

# é–¢æ•°æ•°ã®å¤šã„ãƒ•ã‚¡ã‚¤ãƒ«
npm run dev -- inspect --type files --sort funcs --desc --limit 10

# ãƒ•ã‚¡ã‚¤ãƒ«çµ±è¨ˆæƒ…å ±è¡¨ç¤º
npm run dev -- inspect --type files --stats
```

#### improve - ã‚³ãƒ¼ãƒ‰æ”¹å–„ï¼ˆsimilarã€safe-deleteã€refactor-guardã®çµ±åˆï¼‰
```bash
# é‡è¤‡ãƒ»é¡ä¼¼ã‚³ãƒ¼ãƒ‰ã®æ¤œå‡ºï¼ˆæ—§similarã®ä»£æ›¿ï¼‰
npm run dev -- improve --type duplicates

# ã‚«ã‚¹ã‚¿ãƒ é¡ä¼¼åº¦é—¾å€¤
npm run dev -- improve --type duplicates --threshold 0.8

# ãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰æ¤œå‡ºï¼ˆæ—§safe-deleteã®ä»£æ›¿ï¼‰
npm run dev -- improve --type dead-code

# ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å®‰å…¨æ€§åˆ†æï¼ˆæ—§refactor-guardã®ä»£æ›¿ï¼‰
npm run dev -- improve --type safety

# åŒ…æ‹¬çš„æ”¹å–„åˆ†æ
npm run dev -- improve
```

#### manage - ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼ˆdbã€diffã€exportã€importã€historyã®çµ±åˆï¼‰
```bash
# ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§
npm run dev -- manage --action=db --list

# ãƒ†ãƒ¼ãƒ–ãƒ«å†…å®¹ç¢ºèª
npm run dev -- manage --action=db --table snapshots --limit 5
npm run dev -- manage --action=db --table functions --where "cyclomatic_complexity > 10" --limit 10

# JSONå‡ºåŠ›ï¼ˆä»–ãƒ„ãƒ¼ãƒ«ã¨ã®é€£æºç”¨ï¼‰
npm run dev -- manage --action=db --table functions --json | jq '.rows[0]'

# ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
npm run dev -- manage --action=export --format json

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸€è¦§
npm run dev -- manage --action=list-backups
```

#### dependencies - ä¾å­˜é–¢ä¿‚åˆ†æï¼ˆdepã®é€²åŒ–ç‰ˆï¼‰
```bash
# ä¾å­˜é–¢ä¿‚æ¦‚è¦ï¼ˆdepã‚³ãƒãƒ³ãƒ‰ã®å¾Œç¶™ï¼‰
npm run dev -- dependencies

# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ«ãƒ¼ãƒ«æ¤œè¨¼
npm run dev -- dependencies --action=lint

# ãƒãƒ–é–¢æ•°åˆ†æ
npm run dev -- dependencies --action=stats --show-hubs

# ãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰æ¤œå‡º
npm run dev -- dependencies --action=dead

# å¾ªç’°ä¾å­˜æ¤œå‡º
npm run dev -- dependencies --action=cycles
```

#### types - TypeScriptå‹ã‚·ã‚¹ãƒ†ãƒ åˆ†æï¼ˆé«˜åº¦ãªå‹è¨­è¨ˆã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹ï¼‰
```bash
# å‹ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§åˆ†æ
npm run dev -- types --action=health

# è¤‡é›‘ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä¸€è¦§
npm run dev -- types --action=list --kind=interface --prop-ge=5

# å‹ä¾å­˜é–¢ä¿‚åˆ†æ
npm run dev -- types --action=deps --type-name="UserProfile"

# APIè¨­è¨ˆæœ€é©åŒ–åˆ†æ
npm run dev -- types --action=api --optimize

# ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³
npm run dev -- types --action=cluster

# å†åˆ©ç”¨å¯èƒ½ãƒ‘ã‚¿ãƒ¼ãƒ³æŠ½å‡º
npm run dev -- types --action=slices --benefit=high

# é‡è¤‡å‹ã®ç‰¹å®š
npm run dev -- types --action=subsume --show-redundant
```

### ğŸŒ† æ–°ã—ã„é«˜åº¦æ©Ÿèƒ½ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ

**assess --advancedã®é«˜åº¦æ©Ÿèƒ½**:
- **å‹•çš„é‡ã¿ä»˜ã‘**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç‰¹æ€§ã«å¿œã˜ãŸé©å¿œå‹é–¾å€¤
- **æ§‹é€ åˆ†æ**: è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³é•åã‚„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç•°å¸¸ã®æ¤œå‡º
- **ãƒªã‚¹ã‚¯è©•ä¾¡**: Zã‚¹ã‚³ã‚¢åˆ†æã«ã‚ˆã‚‹çµ±è¨ˆçš„ãƒªã‚¹ã‚¯è©•ä¾¡
- **å“è³ªã‚²ãƒ¼ãƒˆ**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å“è³ªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

**typesã‚³ãƒãƒ³ãƒ‰ã®é«˜åº¦æ©Ÿèƒ½**:
- **ã‚³ãƒ¼é€²åŒ–åˆ†æ**: å‹ã®å¤‰æ›´å±¥æ­´ã‚„ç›¸é–¢é–¢ä¿‚ã®åˆ†æ
- **ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆåˆ†æ**: è¡Œå‹•ãƒ™ãƒ¼ã‚¹ã®å‹é¡ä¼¼æ€§æ¤œå‡º
- **ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**: å‹å¤‰æ›ãƒã‚§ãƒ¼ãƒ³ã®å¯è¦–åŒ–
- **ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°**: å†åˆ©ç”¨å¯èƒ½ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç™ºè¦‹

**dependenciesã‚³ãƒãƒ³ãƒ‰ã®é«˜åº¦æ©Ÿèƒ½**:
- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ«ãƒ¼ãƒ«ã‚¨ãƒ³ã‚¸ãƒ³**: è¨­è¨ˆãƒ«ãƒ¼ãƒ«ã®è‡ªå‹•æ¤œè¨¼
- **çµ±åˆæˆ¦ç•¥æ¨è–¦**: ã‚³ãƒ¼ãƒ‰å…±é€šåŒ–ã®æœ€é©é…ç½®æ¨è–¦
- **PageRankä¸­å¿ƒæ€§åˆ†æ**: ãƒœãƒˆãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®ç‰¹å®š
- **ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹åˆ†æ**: é‡è¦ãªä¾å­˜çµŒè·¯ã®ç‰¹å®š

### ğŸ¯ å“è³ªæŒ‡æ¨™ã®ç†è§£

#### ğŸš¨ CRITICAL: Cyclomatic Complexityï¼ˆCCï¼‰ã®æ­£ã—ã„ç†è§£

**CCã¯ã€Œã‚·ã‚°ãƒŠãƒ«ã€ã§ã‚ã‚Šã€Œæ±ºå®šäº‹é …ã€ã§ã¯ãªã„**

##### âœ… æ­£ã—ã„CCç†è§£
- **CCã¯è¤‡é›‘ã•ã®å­˜åœ¨ã‚’çŸ¥ã‚‰ã›ã‚‹æ¸©åº¦è¨ˆ**
- **é«˜CC = åˆ¤æ–­ãŒå¿…è¦ãªç®‡æ‰€**ã§ã‚ã‚Šã€è‡ªå‹•çš„ãªåˆ†å‰²å¯¾è±¡ã§ã¯ãªã„
- **è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ãŒè¤‡é›‘ãªã®ã¯å½“ç„¶**

##### ğŸš¨ çµ¶å¯¾ç¦æ­¢ï¼šæ©Ÿæ¢°çš„CCå‰Šæ¸›
```bash
# âŒ ã“ã‚Œã‚‰ã¯ç¦æ­¢ - CCå€¤ã«ã‚ˆã‚‹æ©Ÿæ¢°çš„ãªå¯¾è±¡é¸å®š
npm run dev -- inspect --cc-ge 20
npm run dev -- inspect --sort cc --desc
```

##### ğŸ“‹ CCå€¤ã®é©åˆ‡ãªåˆ¤æ–­åŸºæº–

**åˆ†å‰²ã™ã¹ãå ´åˆ**:
- **è¤‡æ•°è²¬å‹™æ··åœ¨**: ç•°ãªã‚‹ç†ç”±ã§å¤‰æ›´ã•ã‚Œã‚‹éƒ¨åˆ†ãŒæ··åœ¨
- **ç‹¬ç«‹æ¦‚å¿µ**: åˆ¥ã€…ã«ç†è§£å¯èƒ½ãªãƒ‰ãƒ¡ã‚¤ãƒ³æ¦‚å¿µãŒæ··åœ¨
- **å†åˆ©ç”¨æ€§**: ä»–ã®å ´æ‰€ã§ã‚‚ä½¿ç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹éƒ¨åˆ†

**åˆ†å‰²ã™ã¹ãã§ãªã„å ´åˆ**:
- **æœ¬è³ªçš„è¤‡é›‘ã•**: ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚„ä»•æ§˜ãã®ã‚‚ã®ã®è¤‡é›‘ã•
- **é †æ¬¡å‡¦ç†**: ä¸€é€£ã®æµã‚Œã¨ã—ã¦ç†è§£ã™ã¹ãå‡¦ç†
- **å¯†çµåˆ**: åˆ†é›¢ã™ã‚‹ã¨ç†è§£ãŒå›°é›£ã«ãªã‚‹éƒ¨åˆ†


#### High Riské–¢æ•°
ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™é–¢æ•°ï¼ˆ**CCå€¤å˜ä½“ã§ã¯ãªã„**ï¼‰ï¼š
- è¤‡é›‘åº¦ãŒé«˜ã„
- ãƒã‚¹ãƒˆãŒæ·±ã„
- è¡Œæ•°ãŒå¤šã„
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•°ãŒå¤šã„

### ğŸ’¡ é–‹ç™ºæ™‚ã®æ´»ç”¨ä¾‹

#### 1. ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¯¾è±¡ã®ç‰¹å®š

**ğŸ¯ å”¯ä¸€ã®æ­£ã—ã„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆä¾‹å¤–ãªã—ï¼‰**:
```bash
# 1. å¿…é ˆï¼šHealth Scoreé«˜åº¦åˆ†æ
npm run dev -- assess --advanced

# 2. æ§‹é€ çš„å•é¡Œã®ã¿ã«æ³¨ç›®ï¼ˆæ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ç„¡è¦–ï¼‰
# - Structural Penalty Breakdown
# - Most Central Functions  
# - Max Fan-inç•°å¸¸å€¤
# - Hub Functions
# - Dynamic Weight Analysisï¼ˆå‹•çš„é‡ã¿ä»˜ã‘åˆ†æï¼‰
```

**ğŸ¯ æ”¹å–„å¯¾è±¡ã®å„ªå…ˆé †ä½**:
1. **High Coupling (Fan-in)**: æœ€å¤§ãƒšãƒŠãƒ«ãƒ†ã‚£è¦å› ï¼ˆ-26.5ptsç­‰ï¼‰
2. **Most Central Functions**: PageRank 100%ã®é–¢æ•°
3. **Hub Functions**: fan-in â‰¥ 10ã®é–¢æ•°
4. **Cyclic Functions**: å¾ªç’°ä¾å­˜ã‚’æŒã¤é–¢æ•°

**çµ¶å¯¾ã«å¾“ã†ã¹ãæ”¹å–„ç›®æ¨™**:
- Overall Health Index: ç¾åœ¨å€¤ â†’ +20ptä»¥ä¸Šå‘ä¸Š
- Max Fan-in: ç¾åœ¨å€¤ â†’ 100æœªæº€
- Hub Functions: ç¾åœ¨æ•° â†’ 30å€‹æœªæº€

**âš ï¸ ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®CCç¢ºèªï¼ˆæ–°è¦é–¢æ•°ãƒã‚§ãƒƒã‚¯ç”¨ã®ã¿ï¼‰**:
```bash
# âœ… è¨±å¯ï¼šæ–°è¦ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«/é–¢æ•°ã®å“è³ªç¢ºèª
npm run dev -- inspect --file src/new-feature.ts
npm run dev -- inspect --name newFunction

# âŒ ç¦æ­¢ï¼šãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¯¾è±¡ã®é¸å®š
npm run dev -- inspect --cc-ge 10  # ã“ã‚Œã¯ç¦æ­¢
```

#### 2. å¤‰æ›´ã®å½±éŸ¿ç¢ºèª
```bash
# å¤‰æ›´å‰å¾Œã®å·®åˆ†ã¨é¡ä¼¼é–¢æ•°
npm run dev -- manage --action=diff --from HEAD~1 --to HEAD --insights

# æ–°è¦è¿½åŠ ã•ã‚ŒãŸé–¢æ•°ã®å“è³ªç¢ºèªï¼ˆã‚³ãƒŸãƒƒãƒˆå‰ãƒã‚§ãƒƒã‚¯ï¼‰
npm run dev -- manage --action=diff --from <ãƒ–ãƒ©ãƒ³ãƒé–‹å§‹æ™‚ã®ãƒ©ãƒ™ãƒ«> --to HEAD
```

#### 3. é‡è¤‡ã‚³ãƒ¼ãƒ‰ã®ç™ºè¦‹
```bash
# é¡ä¼¼é–¢æ•°ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¡¨ç¤ºï¼ˆæ—§similarã®ä»£æ›¿ï¼‰
npm run dev -- improve --type duplicates

# ã‚«ã‚¹ã‚¿ãƒ é¡ä¼¼åº¦é—¾å€¤ã§æ¤œå‡º
npm run dev -- improve --type duplicates --threshold 0.8
```

### ğŸ¯ diffã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹å“è³ªãƒã‚§ãƒƒã‚¯æ‰‹æ³•

**é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: ãƒ–ãƒ©ãƒ³ãƒä½œæ¥­é–‹å§‹æ™‚ã«ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’å–å¾—ã—ã€ä½œæ¥­å®Œäº†å¾Œã«diffã‚³ãƒãƒ³ãƒ‰ã§å“è³ªå¤‰åŒ–ã‚’ç¢ºèª

#### åŸºæœ¬çš„ãªæ‰‹é †
```bash
# 1. ãƒ–ãƒ©ãƒ³ãƒé–‹å§‹æ™‚ã«ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä½œæˆ
git checkout -b feature/my-feature
npm run dev -- measure --label feature/my-feature

# 2. é–‹ç™ºä½œæ¥­ã‚’å®Ÿæ–½
# [ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä½œæ¥­]

# 3. ä½œæ¥­å®Œäº†å¾Œã«ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä½œæˆ
npm run dev -- measure --label feature/my-feature-final

# 4. å“è³ªå¤‰åŒ–ã®ç¢ºèªï¼ˆé‡è¦ï¼‰
npm run dev -- manage --action=diff --from feature/my-feature --to HEAD
```

#### å“è³ªãƒã‚§ãƒƒã‚¯ã®ãƒã‚¤ãƒ³ãƒˆ

**æ–°è¦è¿½åŠ é–¢æ•°ã®å“è³ªåŸºæº–ï¼ˆäºˆé˜²çš„å“è³ªç®¡ç†ï¼‰:**
- **Health Scoreå‘ä¸Š**: æ–°è¦è¿½åŠ ã«ã‚ˆã‚ŠHealth ScoreãŒæ‚ªåŒ–ã—ã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª

**ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°åŠ¹æœã®è©•ä¾¡ï¼ˆæ”¹å–„çš„å“è³ªç®¡ç†ï¼‰:**
- **Health Scoreå‘ä¸Š**: å…¨ä½“çš„ãªå“è³ªæŒ‡æ¨™ï¼ˆ18.2/100ç­‰ï¼‰ãŒæ”¹å–„ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
- **Component Scoresæ”¹å–„**: Code Size, Maintainability, Complexityã®å„ã‚¹ã‚³ã‚¢å‘ä¸Šã‚’ç¢ºèª
- **æ§‹é€ çš„å•é¡Œã®æ”¹å–„**: Hubé–¢æ•°ã€å¾ªç’°ä¾å­˜ã€å·¨å¤§ãƒ•ã‚¡ã‚¤ãƒ«ç­‰ã®æ”¹å–„ã‚’ç¢ºèª

**å…±é€šãƒã‚§ãƒƒã‚¯é …ç›®:**
- **High Riské–¢æ•°ã®å¢—åŠ **: æ–°ãŸã«High Riské–¢æ•°ãŒç”Ÿæˆã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª
- **é–¢æ•°ã®åˆ†é¡**: çœŸã®è¿½åŠ ã‹ã€æ—¢å­˜é–¢æ•°ã®å¤‰æ›´ãƒ»ç§»å‹•ãƒ»ãƒªãƒãƒ¼ãƒ ã‹ã‚’æŠŠæ¡

#### å“è³ªå•é¡Œç™ºè¦‹æ™‚ã®å¯¾å¿œ
```bash
# Health Scoreã§æ§‹é€ çš„å•é¡Œã‚’ç‰¹å®šï¼ˆé«˜åº¦åˆ†æï¼‰
npm run dev -- assess --advanced

# æ§‹é€ çš„å•é¡Œã®è©³ç´°ç¢ºèªï¼ˆæ–°dependenciesã‚³ãƒãƒ³ãƒ‰ï¼‰
npm run dev -- dependencies --action=lint

# ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å®Ÿæ–½å¾Œã«å†ç¢ºèª
npm run dev -- manage --action=diff --from <before-label> --to HEAD
```

#### ãƒ¡ãƒªãƒƒãƒˆ
1. **å®¢è¦³çš„ãªå“è³ªè©•ä¾¡**: æ•°å€¤ã«ã‚ˆã‚‹å®šé‡çš„ãªå“è³ªå¤‰åŒ–ã®æŠŠæ¡
2. **ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°åŠ¹æœã®å¯è¦–åŒ–**: æ§‹é€ çš„æ”¹å–„ã®è¨¼æ‹ ã‚’æ®‹ã›ã‚‹
3. **å“è³ªåŠ£åŒ–ã®æ—©æœŸç™ºè¦‹**: ã‚³ãƒŸãƒƒãƒˆå‰ã«å“è³ªå•é¡Œã‚’æ¤œå‡º
4. **ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®æƒ…å ±æä¾›**: PRãƒ¬ãƒ“ãƒ¥ãƒ¼ã§å“è³ªå¤‰åŒ–ã‚’æ˜ç¤ºå¯èƒ½

### âš ï¸ æ³¨æ„äº‹é …

- ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯DBã«ä¿å­˜ã•ã‚Œã‚‹ãŒã€ç¾åœ¨ã®å®Ÿè£…ã§ã¯ä¸€éƒ¨ã®ãƒ‡ãƒ¼ã‚¿ãŒæ°¸ç¶šåŒ–ã•ã‚Œãªã„å ´åˆãŒã‚ã‚‹
- `--label`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«æ„å‘³ã®ã‚ã‚‹åå‰ã‚’ä»˜ã‘ã‚‹ã“ã¨ã‚’æ¨å¥¨
- PGLiteã¯WebAssemblyãƒ™ãƒ¼ã‚¹ã®PostgreSQLãªã®ã§ã€é€šå¸¸ã®PostgreSQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ä½¿ç”¨ä¸å¯

## ğŸ”„ é©åˆ‡ãªå…±é€šåŒ–ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ‰‹é †

### æ¦‚è¦

`similar`ã‚³ãƒãƒ³ãƒ‰ã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æƒ…å ±ã‚’æ´»ç”¨ã—ã¦ã€é©åˆ‡ã‹ã¤å®‰å…¨ãªé–¢æ•°å…±é€šåŒ–ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’å®Ÿè¡Œã™ã‚‹åŒ…æ‹¬çš„ãªæ‰‹é †ã§ã™ã€‚

### ğŸ¯ åŸºæœ¬åŸå‰‡

1. **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£éµå®ˆ**: ãƒ¬ã‚¤ãƒ¤ãƒ¼å¢ƒç•Œã‚’è¶…ãˆãŸä¸é©åˆ‡ãªå…±é€šåŒ–ã‚’å›é¿
2. **çµ±åˆæˆ¦ç•¥ã®é©ç”¨**: é–¢æ•°ã®æ€§è³ªã«å¿œã˜ãŸé©åˆ‡ãªé…ç½®æ±ºå®š
3. **å“è³ªç¢ºä¿**: å…±é€šåŒ–å¾Œã‚‚è¤‡é›‘åº¦ã¨ä¿å®ˆæ€§ã‚’ç¶­æŒ

### ğŸ“‹ å®Œå…¨ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

#### ã‚¹ãƒ†ãƒƒãƒ—1: äº‹å‰æº–å‚™ã¨ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ä½œæˆ

```bash
# 1. ãƒ–ãƒ©ãƒ³ãƒä½œæˆã¨ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ä½œæˆ
git checkout -b refactor/consolidate-similar-functions
npm run dev -- measure --label refactor-baseline

# 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æƒ…å ±ã®ç¢ºèª
npm run dev -- dependencies --action=lint --show-consolidation    # çµ±åˆæˆ¦ç•¥ã‚’ç¢ºèª
npm run dev -- dependencies --action=lint --show-layers          # ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’ç¢ºèª
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: é¡ä¼¼é–¢æ•°ã®ç™ºè¦‹ã¨åˆ†æ

```bash
# 3. é¡ä¼¼é–¢æ•°ã®æ¤œå‡ºï¼ˆæ–°improveã‚³ãƒãƒ³ãƒ‰ï¼‰
npm run dev -- improve --type duplicates

# 4. é«˜è¤‡é›‘åº¦é–¢æ•°ã®ç¢ºèªï¼ˆå…±é€šåŒ–å¯¾è±¡ã®å„ªå…ˆé †ä½ä»˜ã‘ï¼‰
npm run dev -- inspect --cc-ge 10 --limit 20

# 5. å“è³ªçŠ¶æ³ã®æŠŠæ¡ï¼ˆé«˜åº¦åˆ†æï¼‰
npm run dev -- assess --advanced
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç†è§£ã«ã‚ˆã‚‹é©åˆ‡ãªé…ç½®æ±ºå®š

**ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æƒ…å ±ã®æ´»ç”¨**

```bash
# ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã®è©³ç´°ç¢ºèª
npm run dev -- dependencies --action=lint --show-layers
```

**ğŸ”§ çµ±åˆæˆ¦ç•¥ã®é©ç”¨**

- **Global Utilsæˆ¦ç•¥** (`utils`å±¤ã¸ã®é…ç½®)
  - æ¡ä»¶: ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ä¸è¦ã€å…¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ä½¿ç”¨å¯èƒ½ã€ç´”ç²‹é–¢æ•°
  - ä¾‹: `path operations`, `string formatting`, `basic validation`
  - ä¿¡é ¼åº¦: `high`

- **Layer Utilsæˆ¦ç•¥** (`layer/shared/`ã¸ã®é…ç½®)
  - æ¡ä»¶: ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰çŸ¥è­˜å¿…è¦ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼å†…è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã§ä½¿ç”¨
  - ä¾‹: `AST parsing helpers`, `SQL query builders`, `CLI formatters`
  - ä¿¡é ¼åº¦: `medium`

- **Keep In Placeæˆ¦ç•¥** (å…±é€šåŒ–ã—ãªã„)
  - æ¡ä»¶: å˜ä¸€ç”¨é€”ã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨å¯†çµåˆã€ç•°ãªã‚‹å®Ÿè£…ãŒå¿…è¦
  - ä¾‹: `specialized analyzers`, `context-specific handlers`
  - ä¿¡é ¼åº¦: `high`

#### ã‚¹ãƒ†ãƒƒãƒ—4: æ®µéšçš„ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å®Ÿè¡Œ

```bash
# 6. é¡ä¼¼é–¢æ•°ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«æ®µéšçš„ã«å®Ÿè¡Œ
# ã‚°ãƒ«ãƒ¼ãƒ—1: Global Utilså€™è£œ
# - ä¾‹: é¡ä¼¼ã™ã‚‹æ–‡å­—åˆ—æ“ä½œé–¢æ•°ã‚’ src/utils/ ã«çµ±åˆ

# ã‚°ãƒ«ãƒ¼ãƒ—2: Layer Utilså€™è£œ  
# - ä¾‹: CLIé–¢é€£ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°ã‚’ src/cli/shared/ ã«çµ±åˆ

# ã‚°ãƒ«ãƒ¼ãƒ—3: åˆ†æç³»é–¢æ•°
# - ä¾‹: ASTè§£æé–¢é€£ã‚’ src/analyzers/shared/ ã«çµ±åˆ
```

#### ã‚¹ãƒ†ãƒƒãƒ—5: å„æ®µéšã§ã®å“è³ªç¢ºèª

```bash
# 7. å„ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œã®å“è³ªãƒã‚§ãƒƒã‚¯
npm run dev -- measure --label refactor-step1
npm run dev -- manage --action=diff --from refactor-baseline --to refactor-step1

# 8. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£é•åã®ãƒã‚§ãƒƒã‚¯
npm run dev -- dependencies --action=lint

# 9. å‹ãƒã‚§ãƒƒã‚¯ã¨ãƒ†ã‚¹ãƒˆ
npm run typecheck
npm run lint
npm test
```

#### ã‚¹ãƒ†ãƒƒãƒ—6: æœ€çµ‚æ¤œè¨¼ã¨å®Œäº†

```bash
# 10. æœ€çµ‚ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä½œæˆ
npm run dev -- measure --label refactor-complete

# 11. å®Œå…¨ãªå·®åˆ†ç¢ºèª
npm run dev -- manage --action=diff --from refactor-baseline --to refactor-complete --insights

# 12. å“è³ªæ”¹å–„ã®ç¢ºèªï¼ˆé«˜åº¦åˆ†æï¼‰
npm run dev -- assess --advanced

# 13. æœ€çµ‚çš„ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¤œè¨¼
npm run dev -- dependencies --action=lint
```

### ğŸ¯ åˆ¤æ–­åŸºæº–ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### âœ… é©åˆ‡ãªå…±é€šåŒ–ã®åˆ¤æ–­åŸºæº–

1. **åŒä¸€ãƒ¬ã‚¤ãƒ¤ãƒ¼å†…ã®é¡ä¼¼é–¢æ•°**
   - ãƒ¬ã‚¤ãƒ¤ãƒ¼å†…shared/ãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®
   - ä¾‹: `src/cli/shared/formatters.ts`

2. **è¤‡æ•°ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ä½¿ç”¨ã™ã‚‹ç´”ç²‹é–¢æ•°**
   - utilsãƒ¬ã‚¤ãƒ¤ãƒ¼ã«é…ç½®
   - ä¾‹: `src/utils/string-utils.ts`

3. **çµ±åˆæˆ¦ç•¥ã®ä¿¡é ¼åº¦è€ƒæ…®**
   - `high`ä¿¡é ¼åº¦: ç©æ¥µçš„ã«çµ±åˆ
   - `medium`ä¿¡é ¼åº¦: æ…é‡ã«åˆ¤æ–­
   - `low`ä¿¡é ¼åº¦: çµ±åˆã‚’é¿ã‘ã‚‹

#### âŒ é¿ã‘ã‚‹ã¹ãå…±é€šåŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³

1. **ãƒ¬ã‚¤ãƒ¤ãƒ¼å¢ƒç•Œé•å**
   ```bash
   # ä¾‹: storageãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é–¢æ•°ã‚’cliãƒ¬ã‚¤ãƒ¤ãƒ¼ã«é…ç½®ï¼ˆNGï¼‰
   # ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­å®šã® avoidCrossLayerSharing ã‚’ç¢ºèª
   ```

2. **å¾ªç’°ä¾å­˜ã®ä½œæˆ**
   ```bash
   # ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯
   npm run dev -- dependencies --action=lint --max-violations 0
   ```

3. **ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã®æ··å…¥**
   ```bash
   # ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰ã®é–¢æ•°ã‚’utilsã«é…ç½®ã™ã‚‹ã®ã¯é¿ã‘ã‚‹
   # ä»£ã‚ã‚Šã«layer/shared/ã«é…ç½®ã™ã‚‹
   ```

### ğŸ” å®Ÿè¡Œä¾‹

```bash
# å®Ÿéš›ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ä¾‹
git checkout -b refactor/consolidate-validators
npm run dev -- measure --label validator-refactor-start

# é¡ä¼¼ã™ã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã‚’ç™ºè¦‹
npm run dev -- improve --type duplicates | grep -i "validat"

# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æƒ…å ±ã‚’ç¢ºèªã—ã¦utilså±¤ã¸ã®é…ç½®ã‚’æ±ºå®š
npm run dev -- dependencies --action=lint --show-consolidation

# å…±é€šåŒ–å®Ÿè¡Œï¼ˆä¾‹: email, url, path ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã‚’utils/validation.tsã«çµ±åˆï¼‰
# [ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ä½œæ¥­]

# å“è³ªç¢ºèª
npm run dev -- measure --label validator-refactor-complete
npm run dev -- manage --action=diff --from validator-refactor-start --to validator-refactor-complete
npm run dev -- assess --advanced

# æœ€çµ‚ãƒã‚§ãƒƒã‚¯
npm run typecheck && npm run lint && npm test
```

### ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

1. **ã‚³ãƒ¼ãƒ‰é‡è¤‡ã®å‰Šæ¸›**: DRYåŸå‰‡ã®é©ç”¨
2. **ä¿å®ˆæ€§ã®å‘ä¸Š**: å˜ä¸€ã®å¤‰æ›´ç®‡æ‰€ã§è¤‡æ•°ç®‡æ‰€ã«åæ˜ 
3. **å“è³ªã®å‘ä¸Š**: å…±é€šåŒ–ã«ã‚ˆã‚Šä¸€ç®‡æ‰€ã§ã®ãƒ†ã‚¹ãƒˆãƒ»æ”¹å–„ãŒå¯èƒ½
4. **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£éµå®ˆ**: ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆã‚’ç¶­æŒã—ãŸé©åˆ‡ãªé…ç½®
5. **è¤‡é›‘åº¦ç®¡ç†**: ä¸é©åˆ‡ãªå…±é€šåŒ–ã«ã‚ˆã‚‹è¤‡é›‘åº¦å¢—åŠ ã‚’å›é¿

### âš ï¸ æ³¨æ„ç‚¹

- **æ®µéšçš„å®Ÿè¡Œ**: ä¸€åº¦ã«å¤§é‡ã®å¤‰æ›´ã‚’è¡Œã‚ãšã€å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã§é€²ã‚ã‚‹
- **ãƒ†ã‚¹ãƒˆé‡è¦æ€§**: å„æ®µéšã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚’æ€ ã‚‰ãªã„
- **å“è³ªç›£è¦–**: å…±é€šåŒ–ã«ã‚ˆã‚Šè¤‡é›‘åº¦ãŒå¢—åŠ ã—ã¦ã„ãªã„ã‹ç¢ºèª
- **ãƒ¬ãƒ“ãƒ¥ãƒ¼æ´»ç”¨**: PRãƒ¬ãƒ“ãƒ¥ãƒ¼ã§çµ±åˆåˆ¤æ–­ã®å¦¥å½“æ€§ã‚’æ¤œè¨¼

## AIå”èª¿ã«ã‚ˆã‚‹èª¿æŸ»æ–¹é‡

### Geminiãƒ„ãƒ¼ãƒ«ã®æ´»ç”¨
èª¿æŸ»ã‚„æŠ€è¡“æ¤œè¨æ™‚ã«ã€ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ã‚’çŠ¶æ³ã«å¿œã˜ã¦çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨ï¼š
- ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«èª¿æŸ»ï¼ˆRead/Grep/Globï¼‰
- Webæ¤œç´¢ï¼ˆWebSearchï¼‰
- Gemini AIç›¸è«‡ï¼ˆgeminiChat/googleSearchï¼‰

### Geminiä½¿ç”¨ã®æ˜ç¤ºçš„æŒ‡ç¤º
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒGeminiã‚’ä½¿ã„ãŸã„å ´åˆã®æŒ‡ç¤ºæ–¹æ³•ï¼š
- ã€ŒGeminiã«èã„ã¦: â—‹â—‹ã€
- ã€ŒGeminiã§æ¤œç´¢: â—‹â—‹ã€
- ã€ŒGeminiçµŒç”±ã§: â—‹â—‹ã€
